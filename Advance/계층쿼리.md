# 계층 쿼리
- 상위 계층과 하위계층의 관계를 오라클에서는 START WITH와 CONNECT BY를 이용해서 쉽게 가져올 수 있다.
- 상품의 카테고리(대분류,중분류,소분류...)를 조회 할때 START WITH와 CONNECT BY를 이용하면 트리 구조로 편리하게 조회 할 수 있다.
- START WITH와 CONNECT BY를 이용해 데이터를 계층적인 순서로 조회할 수 있습니다. 

- `START WITH` : 계층 질의의 루트(부모행)로 사용될 행을 지정, 서브쿼리 사용 가능
- `CONNECT BY` : 계층 질의에서 상위계층(부모행)과 하위계층(자식행)의 관계를 규정, `PRIOR`연산자를 많이 사용, 서브쿼리 사용 불가
- CONNECT BY 의 실행 순서
  - 1. START WITH 절, 2. CONNECT BY 절, 3. WHERE 절
- `LEVEL` 예약어를 통해 depth 를 표현할 수 있다.
```oracle-sql
 SELECT LEVEL,empno,ename, mgr
       FROM  emp
       START WITH job = 'PRESIDENT'   -- 직업이 PRESIDENT를 기준으로
       CONNECT BY PRIOR  empno = mgr; -- 사원(empno)과 관리자(mgr)의  관계를 계층 구조
```
```oracle-sql
   LEVEL      EMPNO ENAME                       MGR
--------- ---------- -------------------- ----------
       1       7839      KING
       2       7566      JONES                      7839
       3       7788      SCOTT                     7566 
       4       7876      ADAMS                     7788 
       3       7902      FORD                       7566
       4       7369      SMITH                       7902
       2       7698      BLAKE                       7839
       3       7499      ALLEN                       7698
       3       7521      WARD                       7698
       3       7654      MARTIN                     7698
       3       7844      TURNER                     7698
       3       7900      JAMES                       7698
       2       7782      CLARK                       7839
       3       7934      MILLER                      7782
```
- LEVEL컬럼은 depth를 나타냅니다.
- JONES의 관리자는 KING을 나타냅니다.
- SCOTT의 관리자는 JONES를 나타냅니다.
- 예제와 같이 상/하의 계층 구조를 쉽게 조회 할 수 있습니다. 


